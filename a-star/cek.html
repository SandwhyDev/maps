<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3D Object Rotation with Device Orientation</title>
    <style>
      body {
        margin: 0;
      }
      canvas {
        display: block;
      }
    </style>
  </head>
  <body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function (event) {
        if (window.DeviceOrientationEvent) {
          // Inisialisasi Three.js
          const scene = new THREE.Scene();
          const camera = new THREE.PerspectiveCamera(
            75,
            window.innerWidth / window.innerHeight,
            0.1,
            1000
          );
          const renderer = new THREE.WebGLRenderer();
          renderer.setSize(window.innerWidth, window.innerHeight);
          document.body.appendChild(renderer.domElement);

          // Membuat kubus 3D sederhana
          const geometry = new THREE.BoxGeometry();
          const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
          const cube = new THREE.Mesh(geometry, material);
          scene.add(cube);

          // Menambah panah untuk menunjukkan arah utara
          const arrowGeometry = new THREE.ConeGeometry(0.5, 2, 8);
          const arrowMaterial = new THREE.MeshBasicMaterial({
            color: 0xff0000,
          });
          const arrow = new THREE.Mesh(arrowGeometry, arrowMaterial);
          arrow.position.set(0, 3, 0);
          arrow.rotation.x = Math.PI / 2; // Memutar panah agar mengarah ke bawah
          scene.add(arrow);

          // Memperbarui posisi kubus berdasarkan data orientasi perangkat
          window.addEventListener(
            "deviceorientation",
            (eventData) => {
              const gamma = eventData.gamma; // Perubahan arah samping (ke kiri atau ke kanan)
              const beta = eventData.beta; // Perubahan arah depan-belakang (miring ke depan atau ke belakang)
              const alpha = eventData.alpha; // Arah kompas

              // Mengatur rotasi kubus berdasarkan data orientasi perangkat
              cube.rotation.x = (beta * Math.PI) / 180;
              cube.rotation.y = (gamma * Math.PI) / 180;

              // Memperbarui rotasi panah agar mengarah ke utara
              arrow.rotation.z = (-(alpha - 180) * Math.PI) / 180;

              // Memperbarui tampilan
              renderer.render(scene, camera);
            },
            false
          );

          // Inisialisasi kamera
          camera.position.z = 5;

          // Fungsi untuk menangani ukuran halaman yang berubah
          function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
          }
          window.addEventListener("resize", onWindowResize, false);

          // Render pertama
          function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
          }
          animate();
        } else {
          console.log("No DeviceOrientationEvent detected");
        }
      });
    </script>
  </body>
</html>
